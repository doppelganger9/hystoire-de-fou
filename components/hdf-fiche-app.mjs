//@ts-check
import { computed, onMounted } from 'vue';
import { useStore } from 'vuex';
import { allStyles } from '../styles/all.mjs';

export const FicheAppComponent = {
    setup() {
        const store = useStore();

        const perso = computed(() => store.state['perso']);
        const infos = computed(() => store.state['infos']);
        const hiddenInfos = computed(() => store.state['hiddenInfos']);
        const mode = computed(() => store.state['mode']);
        const hiddenVoile = computed(() => store.state['hiddenVoile']);
        const hiddenPopupCompetence = computed(() => store.state['hiddenPopupCompetence']);
        const nouvelleCompetence = computed(() => store.state['nouvelleCompetence']);
        const hiddenPopupJet = computed(() => store.state['hiddenPopupJet']);
        const etatJet = computed(() => store.state['etatJet']);
        const creationFinie = computed(() => store.getters['creationFinie']);

        const passerEnMode = (mode) => {
            store.commit('passerEnMode', mode);
        };

        onMounted(() => {
            console.log('mounted FicheAppComponent');
        });

        return {
            // methods
            passerEnMode,
            // computed state
            perso,
            infos,
            hiddenInfos,
            mode,
            hiddenVoile,
            hiddenPopupCompetence,
            nouvelleCompetence,
            hiddenPopupJet,
            etatJet,
            // computed getters
            creationFinie,
        };
    },
    template: `
    <h1>Hystoire de Fou</h1>
    <h2>Fiche de Personnage int√©ractive</h2>
    <div id="app" :class="'visible'" class="hidden">
        <!-- affich√© avant que l'app soit pr√™te -->
        <h3 v-if="false" class="visible menu">En cours de chargement...</h3>
        <hdf-voile></hdf-voile>
        <hdf-menu-lancement></hdf-menu-lancement>
        <div v-if="mode !=='menu'" class="fiche">
            <hdf-popup-infos></hdf-popup-infos>
            <p class="tutoriel" v-if="mode === 'cr√©ation'">Vous allez maintenant cr√©er votre personnage.
                La seule contrainte est que les personnages d'un groupe de jeu partagent tous un point commun de d√©part.
                Votre meneur/meneuse devrait d√©j√† vous l'avoir indiqu√©, sinon posez la question.
                A part cela, gardez √† l'esprit que les personnages joueurs d'Hystoire de Fou sont des gens ordinaires, contemporains, vivant une vie normale.
                Ils ne sont pas fous. Pas encore üòá ! Ce ne sont pas non plus des aventuriers.
            </p>
            <p class="tutoriel" v-if="mode === 'cr√©ation'">
                Suivez les indications dans les blocs d'aide comme celui-ci, 
                et aussi en cliquant sur les boutons d'informations ‚ÑπÔ∏è. <br/>
                Vous devrez d'abord saisir les informations d'√©tat civil de votre personnage,<br/>
                Puis r√©partir ses caract√©ristiques,<br/>
                et enfin lui choisir une comp√©tence professionnelle.<br/>
                Cela devrait √™tre rapide, comptez maximum 10 minutes.<br/>
                <br/>
                Une fois termin√© le bouton ci-dessous deviendra clicable pour terminer la cr√©ation et la valider.
                <button v-if="mode==='cr√©ation'" :disabled="!creationFinie" @click="passerEnMode('jeu')">
                    Cr√©ation de personnage termin√©e
                </button>
            </p>
            <hdf-popup-jet v-if="mode==='jeu'"></hdf-popup-jet>
            <hdf-popup-creation-competence></hdf-popup-creation-competence>
            <hdf-popup-effets-dementiels v-if="mode==='jeu'"></hdf-popup-effets-dementiels>

            <hdf-bloc-etat-civil v-if="mode==='cr√©ation'"></hdf-bloc-etat-civil>
            <hdf-bloc-caracteristiques v-if="mode==='cr√©ation'"></hdf-bloc-caracteristiques>
            <hdf-bloc-competences v-if="mode==='cr√©ation'"></hdf-bloc-competences>
            <hdf-bloc-sante-mentale v-if="mode==='cr√©ation'"></hdf-bloc-sante-mentale>
            
            <hdf-bloc-caracteristiques v-if="mode==='jeu'"></hdf-bloc-caracteristiques>
            <hdf-bloc-etat-civil v-if="mode==='jeu'"></hdf-bloc-etat-civil>
            <hdf-bloc-sante-mentale v-if="mode==='jeu'"></hdf-bloc-sante-mentale>
            <hdf-bloc-sante v-if="mode==='jeu'"></hdf-bloc-sante>
            <hdf-bloc-competences v-if="mode==='jeu'"></hdf-bloc-competences>

            <hdf-bloc-competences-dementielles v-if="mode==='jeu'"></hdf-bloc-competences-dementielles>
            <hdf-bloc-equipement v-if="mode==='jeu'"></hdf-bloc-equipement>
            <hdf-bloc-journal v-if="mode==='jeu'"></hdf-bloc-journal>
            <p class="tutoriel" v-if="mode === 'cr√©ation'">
                Si vous avez tout rempli comme demand√©, le bouton ci-dessous devrait √™tre clicable pour terminer la cr√©ation et la valider.<br/>
                Sinon remontez et v√©rifiez que vous avez bien tout saisi.
                <button v-if="mode==='cr√©ation'" :disabled="!creationFinie" @click="passerEnMode('jeu')">
                    Cr√©ation de personnage termin√©e
                </button>
            </p>

        </div>
    </div>    
    `,
    styles: [
        allStyles // TODO n'importer que les styles de ce composant ?
    ],
};
